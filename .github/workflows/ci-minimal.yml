name: CI Minimal Test

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  minimal-test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10", "3.11"]

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential
    
    - name: Install basic dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        pip install numpy pandas scipy matplotlib seaborn
    
    - name: Install core dependencies step by step
      run: |
        pip install scikit-learn
        pip install pydantic pyyaml
        pip install typer rich
    
    - name: Try pydantic-settings
      run: |
        pip install pydantic-settings || echo "pydantic-settings failed"
    
    - name: Install package in development mode
      run: |
        pip install -e . --no-deps
    
    - name: Test basic imports
      run: |
        python -c "import tier1_suite; print('✓ Basic import works')"
        python -c "from tier1_suite.config.settings import GlobalConfig; print('✓ Config import works')"
    
    - name: Install test dependencies
      run: |
        pip install pytest pytest-cov pytest-mock
    
    - name: Run minimal tests
      run: |
        python -m pytest tests/test_schemas.py -v || echo "Schema tests failed"
        python -m pytest tests/test_leakage.py -v || echo "Leakage tests failed"